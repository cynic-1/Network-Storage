# 银行存储系统设计方案

1. 虚拟化（云）平台 （可考虑直接构建私有云环境）
2. 100%的冗余方案
3. 100TB 每年增长30% 满足3年
4. 业务部门的划分 生产业务区、综合管理区、网银在线区、产品测试区、运维基础区
5. 非结构化数据
6. 网络拓扑设计 带宽 高峰和低谷期
7. 系统设计 硬件冗余和集群
8. RPO接近于0，尽量没有数据丢失，RTO尽可能小
9. 高扩展性，而且以虚拟化部署为主
10. 数据安全 隐私性
11. 容灾规划







## 一、问题背景

随着金融产业的不断升级，金融信息化已成为金融行业的重要环节。银行在央行与银保监会等机构的监督和管理下，信息化进程逐步加快推进。随着业务的变化和云计算技术的的成熟，应用场景和需求变化越来越难以控制，银行业务高速发展，某500强银行原有平台CDC传统的数据中心解决方案已经满足不了目前的应用需求的大量迭代，同时设备和应用的运维挑战难度极高。如何在技术和业务双层面优化存储系统，成为摆在该银行面前的重要挑战。总部决定构建大中华区全新的虚拟化（云）平台，采用成熟的虚拟化方案构建虚拟化数据中心，需要一套虚拟化实施方案。

## 二、需求分析

### 1. 业务部门划分需求

银行业务可分为五个分区，生产业务区、综合管理区、网银在线区、产品测试区、运维基础区，产生的数据主要都是非结构化数据。为了保证数据的安全，可访问性应根据不同业务进行划分，每个区的权限与资源分配有差别，具体划分如下：

* 生产业务区：生产业务相关数据读写权限；面向客户的核心数据，分配可用性最高的存储资源
* 综合管理区：所有权限；普通的存储资源
* 网银在线区：相关数据读写权限；面向客户的核心数据，分配可用性最高的存储资源
* 产品测试区：测试数据的读写权限；普通的存储资源
* 运维基础区：生产业务区和网银在线区的数据读写权限；普通存储资源

### 2. 带宽需求

需要先由业务制定业务指标（最大并发用户，吞吐量，响应时间等），让性能测试组根据预定业务指标去进行业务系统压力测试，根据业务高峰期时的网络资源使用情况估算下生产环境的网络带宽等网络配置。

### 3. 数据完整性

银行业务系统和办公系统作为主要系统，必须为系统用户提供准确的数据访问服务，故数据的完整性是重要需求。

### 4. 数据可用性与容灾

银行存取款业务需要7*24工作，其他核心业务也要求极高的可用性，数据丢失的代价极大，对于数据保存的要求非常严格，所以设计好系统的高可用性极为重要，必须保证RPO接近于0，尽量没有数据丢失，RTO尽可能小，可以容忍一小段时间的宕机。银行系统产生的用户数据，是银行非常重要的资产，一旦数据损失，后果是灾难性的。为了保证业务的可连续性(BC)，必须对存储系统做好灾备，本地数据备份和异地灾备中心都是非常重要的容灾手段。

### 5. 数据机密性

银行数据都具有很强的隐私性，所以必须保证数据机密性，防止不拥有权限的用户非法访问数据。

### 5. 系统可拓展性

随着银行业务的不断扩大，用户数据的不断累计，所需要的存储空间至少随着线性速度增长，所以存储系统必须具备很高的可扩展性，并且通过虚拟化部署使得扩展过程更简单、快捷。

## 三、目标设计



## 四、存储方案设计

https://blog.51cto.com/u_15127572/2726299

https://www.talkwithtrend.com/Article/253157

### 4.1 业务划分

 根据目前规划的5个分区：生产业务区、综合管理区、网银在线区、产品测试区、运维基础区，由于每个分区对于虚拟机的数量以及性能上的需求不同，故分配方案如下：

​	银行的业务总体可以分为需求设计，资产业务、中间业务三类，因此生产业务区的设计可以主要根据这三类业务分配虚拟机。由于这三类业务的每类任务都部署装有同样软件的虚拟机，并需要根据操作员人数分配相应数量的终端服务器。

因此我们为每类业务分配一台配置较高的虚拟机作为终端服务器。从而满足每类业务异构性的需求，使一台服务器可以对应多台终端，这样所需的主机资源数为终端数与终端服务器数求和。

​    综合管理区类似于传统的信息管理系统，因此只需要为其同样分配一台配置较高的虚拟机作为终端服务器以及满足需求的虚拟机数量即可。

​    网银在线区承担银行的网银业务，该区域的特点是访问量随时间变化较为明显，所以网银在线区需要根据当前实际网银业务访问量动态调整虚拟机的数量，从而对网银业务实现负载均衡；同时由于网银在线区的虚拟机需要作为Web服务器使用而终端服务器使用，因此网银在线区的服务器需要承载更高的业务量，这也要求每台虚拟机需要更高的配置。

​    服务器产品测试区需要为银行的新产品进行测试，但是总体需求的资源比较少，我们可以为每个产品根据其需求分配一台服务器终端服务器/Web服务器，在分配时需要根据业务的实际需求，分配配置尽可能与生产环境近似的虚拟机。

​    运维基础区需要对生产业务区、 综合管理区、供运维服务，运维需要将一些数据直接存储到主机中，而运维数据需要存诸在银行的系统中而非运维人员本人主机中，同时运维基础区需要尽可能稳定的网络环境，因此直接分配客户虚拟机是较好的选择，故在运维基础区对生产业务区的三个终端服务器、网银在线区、综合管理区各分配一台虚拟机作为运维使用的虚拟机。

### 4.2 分级存储

#### 4.2.1 基础设施

采用分布式存储方案，因为银行每天的数据量相当大，需要的磁盘等存储设备数量也很多。如果使用集中式存储建设周期太长，架构复杂，故障排查难度大，而且扩展性不够好，所以采用分级存储的三级架构。

**SAS和SATA区别**

机械硬盘主要为SATA和SAS接口，目前家用类别的移动硬盘多为SATA接口，SAS接口则为企业级应用。SAS可满足高性能、高可靠性的应用，SATA则满足大容量、非关键业务的应用。

![SAS盘和SATA盘的区别](https://imgconvert.csdnimg.cn/aHR0cHM6Ly9leHAtcGljdHVyZS5jZG4uYmNlYm9zLmNvbS82NWJhODgwYjMxMjEwNTYxNThjZTFiNWMwOGFlZThkNzU4MmE2YWM2LmpwZw?x-oss-process=image/format,png)

RAID （ Redundant Array of Independent Disks ），通常简称为磁盘阵列。简单地说， RAID 是由多个独立的高性能磁盘驱动器组成的磁盘子系统，从而提供比单个磁盘更高的存储性能和数据冗余的技术。 RAID可以在部分磁盘（单块或多块，根据实现而论）损坏的情况下，仍能保证系统不中断地连续运行。在重建故障磁盘数据至新磁盘的过程中，系统可以继续正常运行，但是性能方面会有一定程度上的降低。一些磁盘阵列在添加或删除磁盘时必须停机，而有些则支持热交换 （ Hot Swapping ），允许在不需要停机的情况下替换磁盘驱动器。这种高端磁盘阵列主要用于要求高可能性的应用系统，系统不能停机或尽可能少的停机时间。RAID技术主要包含RAID 0~RAID 7等数个范围，它们的功能和优劣各不相同。

#### 4.2.2 在线存储配置

对于在线存储，由于该部分的银行业务属于要求高频率读取、数据恢复能力强的类型，而且需要尽可能避免数据丢失，属于对数据安全等级要求非常高的场合，故考虑使用RAID 6，RAID 6采用双分布式奇偶校验，尽管实现代价很高，控制器的设计也比其他等级更复杂、更昂贵，但是为了保证该银行高数据访问并发性以及数据丢失恢复的要求，因此考虑使用RAID 6分布式存储并且搭配4个热备盘，从而进一步提升系统对于磁盘错误的容忍能力。硬件选择方面，SSD硬盘有着现阶段最优的读写速度，同时由于其中没有活动的机械部件，存于其中的数据不易损坏，因此适合数据交换频繁的在线存储。

#### 4.2.3 近线存储配置

对于近线存储，如果仍然使用RAID 6则成本较高，得不偿失，而RAID 5同样提供了存储数据和分布式奇偶校验数据的能力，数据块和对应的校验信息存保存在不同的磁盘上，当一个数据盘损坏时，系统可以根据同一条带的其他数据块和对应的校验数据来重建损坏的数据；RAID 5磁盘利用率较高，兼顾存储性能、数据安全和存储成本等各方面因素，选用RAID 5是一种较为折中的方案。硬件选择方面，使用SAS硬盘，SAS是新一代的SCSI技术，采用串行技术以获得较高的传输速度，相比于SSD成本较低。

#### 4.2.4 离线存储配置

对于离线存储，由于要求容量大且成本低，如果仍然采用之前的存储方案，成本都将较为高额的同时带来了繁重的管理开销；故考虑采用CAS架构来对超过一个月的数据进行归档，理由如下：

1. 降低存储管理开销。无需重新配置的可扩展性 CAS的优秀功能提供了自我配置、自我管理和自我修复能力，这些特性再结合CAS的RAIN架构，有助于硬件的扩展，而且在扩充容量时不会带来中断。CAS可自动进行存储管理，从而降低总体拥有成本，提高投资回报率。

2. 保障数据安全可靠。数据的安全性、完整性、正确性直接影响档案服务质量，因此存储系统需要具有很强的数据安全性，必须能够采用一些高级的数据存储保护技术。CAS系统设备全部为冗余设计, 没有单点故障。为了确保内容的完整可靠，CAS为每个存储对象指定一个唯一的内容地址。这个地址是由内容本身衍生而来的，同一内容绝不会重复保存。数据全部采用镜像或奇偶效验方式存储, 即使发生磁盘及某个存储部件损坏的情况，也不会出现数据丢失，而且CAS具有自我治愈功能，因此对服务的要求也大大降低。

3. 降低总体拥有成本。CAS方案使用户可以规划业务系统的全在线存储模式，真正实现所有归档数据全部处于在线状态，为系统的快速响应能力提供完全保障。由于磁盘阵列成本的主要部分是硬盘，而硬盘单位存储容量的价格通常会呈明显下跌的趋势，逐年扩展CAS容量可以作为用户控制存储投资的首选方式。采用CAS方案，可以省去传统归档存储方案中昂贵的光盘库或磁带库的长期投资，使系统整体投资水平和执行效率都可同时获得优化。
4. 硬件选择方面，这一级中要求设备具有高可靠性、良好的安全性、大容量和低成本，因此选择SATA磁盘阵列。

### 4.3 容量规划



## 五、网络架构设计

要点：**存储网络的架构组成** **网络拓扑**

**新型数据中心：扁平网络拓扑和聚合存储**

转到更扁平网络的数据中心是为了减少交换层次数量，以消除延迟和降低管理复杂性，供应商承诺采用一些预标准技术，如多链路透明互联(TRILL)[和思](https://www.dqsheffield.com/hkhs)科的叠加传输虚拟化(OTV) 来实现这个目标。

这迫使网络工程师和架构师必须仔细了解许多专利技术。这样，他们最终会面临许多新架构和技术选择--这意味在投入资源之前需要进行更多的研究。

为了转到这种新型数据中心网络并实现私有云，架构师还必须使用数据中心桥接、以太网光纤通道(FCoE)或I/O虚拟化技术，来整合数据中心和存储基础构架，从而减少安装[服务器](https://www.dqsheffield.com/server/)机架所需要的布线、网络接口卡(NIC)和主总结适配器。

**使用虚拟化集群交换技术来管理扁平网络**

UCLA神经成像实验室(LONI)对大脑进行绘图，并持续将扫描数据保存到将近PB存储量的影像数据库，1,000名研究人员会不停地访问这个数据库，以了解和治疗老年痴呆症和精神分裂症等疾病。同时上百名研究人员会同时在线处理从20MB至几百GB的数据。

LONI最近实施了一个无阻塞扁平2层协议网络，直接将所有机架服务器相连，但是它所采用的是虚拟集群交换技术，即对顶级机架[交换机](https://www.dqsheffield.com/module/27720.html)进行分组，通过一个虚拟机架将它们进行统一管理，从而提高网络管理效率。

除了高性能数据中心，随着封闭的[企业数据中心](https://www.dqsheffield.com/k/server/2009-6/625322.html)开始在地理上分散各地，虚拟机架在企业网络管理中发挥了中枢作用。目前，大多数集群交换或虚拟机架解决方案的缺点是互操作性不强。

**云网络需要扁平化和以太网结构**

网络供应商认为对于网络而言，简单性和优化要比扁平更为重要。云自动化，即按需分配和收回服务器、存储、网络、应用程序，是非常重要的。

供应商的自动[化工](https://www.dqsheffield.com/industry/1617.html)具和接口根据硬件的不同而不同，特别是专门的交换[操作系统](https://www.dqsheffield.com/module/27659.html)，这就是为什么数据中心内网络的优先级不高。但是通过使用标准来提升互操作性，从而简化数据中心网络的自动化负载分配任务，或者由网络管理员以一个交换机、一个交换结构视图来管理网络基础架构，有利于保证平稳地过渡到以太网结构和未来的开放网络[软件](https://www.dqsheffield.com/industry/1593.html)。





## 六、虚拟化方案

要点：**虚拟化后共享存储容量的规划**



根据统计数据，私有云仍然非常流行，但是什么使它如此出色呢？以下是私有云技术的一些优点：

- 易于掌控
  专用云通常位于现场或数据中心提供商处，因此在需要时更易于访问。您的IT团队可以有效地管理平台并在需要时进行更改。他们可以预测停机时间和服务交付瓶颈。他们还可以更好地根据公司需求调整资源的使用。另一方面，使用公共云的人在管理其资源方面没有那么多的灵活性。
- 稳定性
  云计算在很大程度上取代了硬盘，计算机，闪存驱动器和USB。尽管它仍然使用许多不同类型的驱动器来构建其存储平台，但它还通过将数据分发到安全的托管站点并确保所有内容保持在线状态，从而提供了更高程度的数据安全性。但是，为了获得最佳保护，您需要适当的协议以及全面的灾难恢复和备份解决方案。
  私有云对于存储敏感文件特别方便，因为您的内部团队负责确保平台持续运行。您不必担心供应商或邻居的活动会影响系统，并且可以更有效地管理基础结构。
- 定制化
  您可以按照最适合您和业务需求的方式配置平台。它们可以适应不同规模，行业，间接费用，目标和其他因素的公司。查看您公司的要求，然后根据可用性，安全性和可伸缩性需求，确定最适合您的方案。
- 合规性
  通过完全控制云存储和带宽，自定义环境或调整安全设置的能力，公司可以更好地控制其基础架构。他们可以根据自己的业务目标构建一个符合相关法律和行业法规的平台。与公共云相反，私有云数据更难成为外部检查或恶意截取的对象。

## 七、云化的微服务方案

 微服务架构的核心概念之一就是每个服务都被打包和部署为离散的独立程序。服务实例应迅速启动，服务的每一个实例都是完全相同的。所以服务都将部署到以下某个环境之中. 

       1. 物理机:  缺点：开发人员不能快速提高物理机的容量，并且在多个物理服务器之间水平伸缩微服务的成本很高
       2. 虚拟机镜像:  微服务优点之一就是能够快速启动和关闭微服务实例，以响应可伸缩性和服务故障事件.  微服务可以打包在虚拟机镜像中，然后开发人员可以在IaaS私有或公有云中快速部署和启动服务的多个实例
       3. 虚拟容器 虚拟容器是在虚拟机镜像上部署微服务的自然延伸，使用虚拟容器(如docker)，可以将单个虚拟机隔离成共享相同虚拟机镜像的一系列独立进程

   基于云的微服务以弹性的概念为中心。在需要时，可以在云上几分钟之内快速布置启动新的虚拟机和容器，如服务需求下降，可以关闭虚拟服务器。这样可显著提高应用程序的水平可伸缩性，也使应用程序更有弹性. 

## 八、业务的标准化定制















